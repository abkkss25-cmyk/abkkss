<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ब्लॉग | ABKKSS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap');
        body { font-family: 'Hind', sans-serif; }
        .glass-nav { background: rgba(21, 128, 61, 0.95); backdrop-filter: blur(10px); }
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <header class="fixed top-0 left-0 w-full z-50 px-4 py-4 text-white glass-nav shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.reload()">
                <div class="bg-white p-2 rounded-xl"><i data-lucide="sprout" class="h-6 w-6 text-green-700"></i></div>
                <h1 class="text-xl font-black uppercase">ABKKSS <span class="text-orange-400">ब्लॉग</span></h1>
            </div>
            <a href="/" class="bg-white/10 hover:bg-white/20 px-5 py-2 rounded-full font-bold text-xs uppercase tracking-widest">होम वापस जाएं</a>
        </div>
    </header>

    <div id="feed-view" class="pt-32 pb-20">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-5xl font-black text-green-900 mb-4 uppercase">कृषि <span class="text-orange-500">समाचार</span></h2>
                <p class="text-slate-500 font-bold">नवीनतम तकनीक और जैविक खेती की जानकारी</p>
            </div>
            
            <div id="blog-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
                </div>
        </div>
    </div>

    <div id="post-view" class="hidden pt-32 pb-20">
        <div class="container mx-auto px-4 max-w-4xl">
            <button onclick="closePost()" class="mb-8 flex items-center gap-2 text-green-700 font-bold hover:text-orange-500 transition-all">
                <i data-lucide="arrow-left"></i> सूची पर वापस जाएं
            </button>
            
            <article class="bg-white rounded-[40px] shadow-2xl overflow-hidden border border-slate-100">
                <div class="h-64 md:h-96 bg-slate-200">
                    <img src="https://images.unsplash.com/photo-1592982537447-7440770cbfc9?auto=format&fit=crop&q=80" class="w-full h-full object-cover">
                </div>
                <div class="p-8 md:p-16">
                    <div id="post-date" class="text-orange-500 font-black uppercase text-xs tracking-widest mb-4"></div>
                    <h1 id="post-title" class="text-3xl md:text-5xl font-black text-green-900 mb-8 leading-tight"></h1>
                    <div id="post-content" class="text-slate-700 text-lg md:text-xl leading-relaxed space-y-6">
                        </div>
                    <div class="mt-12 pt-8 border-t border-slate-100 flex items-center gap-4">
                        <div class="bg-green-100 p-3 rounded-full"><i data-lucide="user" class="text-green-700"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">लेखक</p>
                            <p id="post-author" class="font-bold text-green-900"></p>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </div>

    <script>
        let allBlogs = [];

        async function fetchBlogs() {
            try {
                const res = await fetch('/api/blogs');
                allBlogs = await res.json();
                renderGrid(allBlogs);
            } catch (err) { console.error("Error:", err); }
        }

        function renderGrid(blogs) {
            const grid = document.getElementById('blog-grid');
            grid.innerHTML = blogs.map((post, index) => `
                <div class="bg-white rounded-[30px] shadow-lg overflow-hidden border border-slate-100 hover:shadow-2xl transition-all">
                    <div class="h-48 bg-slate-200">
                        <img src="https://images.unsplash.com/photo-1592982537447-7440770cbfc9?auto=format&fit=crop&q=80" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-green-900 mb-3 line-clamp-2">${post.title}</h3>
                        <p class="text-slate-500 text-sm mb-6 line-clamp-3">${post.content}</p>
                        <button onclick="openPost('${post._id}')" class="w-full bg-green-50 text-green-700 font-bold py-3 rounded-xl hover:bg-green-700 hover:text-white transition-all">
                            पूरा पढ़ें
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function openPost(id) {
            const post = allBlogs.find(b => b._id === id);
            if (!post) return;

            document.getElementById('feed-view').classList.add('hidden');
            document.getElementById('post-view').classList.remove('hidden');

            document.getElementById('post-title').innerText = post.title;
            document.getElementById('post-date').innerText = new Date(post.createdAt).toLocaleDateString('hi-IN', { dateStyle: 'full' });
            document.getElementById('post-author').innerText = post.author || 'व्यवस्थापक';
            
            // Convert newlines to paragraphs for better reading
            document.getElementById('post-content').innerHTML = post.content
                .split('\n')
                .map(para => `<p>${para}</p>`)
                .join('');

            window.scrollTo(0,0);
            lucide.createIcons();
        }

        function closePost() {
            document.getElementById('feed-view').classList.remove('hidden');
            document.getElementById('post-view').classList.add('hidden');
            window.scrollTo(0,0);
        }

        window.onload = fetchBlogs;
    </script>
</body>
</html>